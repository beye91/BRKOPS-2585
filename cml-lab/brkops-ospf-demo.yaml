lab:
  version: "0.2.2"
  title: BRKOPS-2585-OSPF-Demo
  description: |
    4 Cat8000v routers in full mesh topology for BRKOPS-2585 demo.
    Features: OSPF routing, MDT Telemetry to Splunk, Syslog, SNMP, NETCONF/YANG.
  notes: |
    Management Network: 198.18.1.0/24 via bridge1
    Inter-Router Links: 10.1.x.0/30 networks
    Loopbacks: 10.255.255.x/32
    Telemetry Target: 198.18.134.22:57400

nodes:
  - id: n0
    label: Router-1
    node_definition: cat8000v
    x: -200
    y: -100
    configuration: |
      hostname Router-1
      !
      enable secret cisco
      username admin privilege 15 secret cisco
      !
      interface GigabitEthernet1
       description MGMT-INTERFACE
       ip address 198.18.1.201 255.255.255.0
       no shutdown
      !
      interface Loopback0
       description OSPF-ROUTER-ID
       ip address 10.255.255.1 255.255.255.255
      !
      interface GigabitEthernet2
       description Link-to-Router-2
       ip address 10.1.12.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet3
       description Link-to-Router-3
       ip address 10.1.13.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet4
       description Link-to-Router-4
       ip address 10.1.14.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      router ospf 1
       router-id 10.255.255.1
       log-adjacency-changes detail
       network 10.1.12.0 0.0.0.3 area 0
       network 10.1.13.0 0.0.0.3 area 0
       network 10.1.14.0 0.0.0.3 area 0
       network 10.255.255.1 0.0.0.0 area 0
      !
      ip route 0.0.0.0 0.0.0.0 198.18.1.1
      !
      logging host 198.18.134.22
      logging trap informational
      logging source-interface GigabitEthernet1
      logging on
      !
      snmp-server community public RO
      snmp-server community private RW
      snmp-server location CML-Lab-dCloud
      snmp-server contact admin@brkops.local
      snmp-server enable traps ospf state-change
      snmp-server enable traps ospf errors
      snmp-server enable traps ospf lsa
      snmp-server enable traps config
      snmp-server enable traps syslog
      snmp-server host 198.18.134.22 version 2c public
      !
      telemetry ietf subscription 101
       encoding encode-kvgpb
       filter xpath /process-cpu-ios-xe-oper:cpu-usage/cpu-utilization/five-seconds
       source-address 198.18.1.201
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 102
       encoding encode-kvgpb
       filter xpath /interfaces-ios-xe-oper:interfaces/interface/statistics
       source-address 198.18.1.201
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 103
       encoding encode-kvgpb
       filter xpath /memory-ios-xe-oper:memory-statistics/memory-statistic
       source-address 198.18.1.201
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 104
       encoding encode-kvgpb
       filter xpath /ospf-ios-xe-oper:ospf-oper-data
       source-address 198.18.1.201
       stream yang-push
       update-policy on-change
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      netconf-yang
      !
      ip domain name brkops.local
      crypto key generate rsa modulus 2048
      !
      line vty 0 4
       login local
       transport input ssh
      !
      line console 0
       logging synchronous
      !
      end
    ram: 4096
    cpus: 1
    interfaces:
      - id: i0
        label: GigabitEthernet1
        slot: 0
        type: physical
      - id: i1
        label: GigabitEthernet2
        slot: 1
        type: physical
      - id: i2
        label: GigabitEthernet3
        slot: 2
        type: physical
      - id: i3
        label: GigabitEthernet4
        slot: 3
        type: physical

  - id: n1
    label: Router-2
    node_definition: cat8000v
    x: 200
    y: -100
    configuration: |
      hostname Router-2
      !
      enable secret cisco
      username admin privilege 15 secret cisco
      !
      interface GigabitEthernet1
       description MGMT-INTERFACE
       ip address 198.18.1.202 255.255.255.0
       no shutdown
      !
      interface Loopback0
       description OSPF-ROUTER-ID
       ip address 10.255.255.2 255.255.255.255
      !
      interface GigabitEthernet2
       description Link-to-Router-1
       ip address 10.1.12.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet3
       description Link-to-Router-3
       ip address 10.1.23.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet4
       description Link-to-Router-4
       ip address 10.1.24.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      router ospf 1
       router-id 10.255.255.2
       log-adjacency-changes detail
       network 10.1.12.0 0.0.0.3 area 0
       network 10.1.23.0 0.0.0.3 area 0
       network 10.1.24.0 0.0.0.3 area 0
       network 10.255.255.2 0.0.0.0 area 0
      !
      ip route 0.0.0.0 0.0.0.0 198.18.1.1
      !
      logging host 198.18.134.22
      logging trap informational
      logging source-interface GigabitEthernet1
      logging on
      !
      snmp-server community public RO
      snmp-server community private RW
      snmp-server location CML-Lab-dCloud
      snmp-server contact admin@brkops.local
      snmp-server enable traps ospf state-change
      snmp-server enable traps ospf errors
      snmp-server enable traps ospf lsa
      snmp-server enable traps config
      snmp-server enable traps syslog
      snmp-server host 198.18.134.22 version 2c public
      !
      telemetry ietf subscription 101
       encoding encode-kvgpb
       filter xpath /process-cpu-ios-xe-oper:cpu-usage/cpu-utilization/five-seconds
       source-address 198.18.1.202
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 102
       encoding encode-kvgpb
       filter xpath /interfaces-ios-xe-oper:interfaces/interface/statistics
       source-address 198.18.1.202
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 103
       encoding encode-kvgpb
       filter xpath /memory-ios-xe-oper:memory-statistics/memory-statistic
       source-address 198.18.1.202
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 104
       encoding encode-kvgpb
       filter xpath /ospf-ios-xe-oper:ospf-oper-data
       source-address 198.18.1.202
       stream yang-push
       update-policy on-change
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      netconf-yang
      !
      ip domain name brkops.local
      crypto key generate rsa modulus 2048
      !
      line vty 0 4
       login local
       transport input ssh
      !
      line console 0
       logging synchronous
      !
      end
    ram: 4096
    cpus: 1
    interfaces:
      - id: i0
        label: GigabitEthernet1
        slot: 0
        type: physical
      - id: i1
        label: GigabitEthernet2
        slot: 1
        type: physical
      - id: i2
        label: GigabitEthernet3
        slot: 2
        type: physical
      - id: i3
        label: GigabitEthernet4
        slot: 3
        type: physical

  - id: n2
    label: Router-3
    node_definition: cat8000v
    x: -200
    y: 100
    configuration: |
      hostname Router-3
      !
      enable secret cisco
      username admin privilege 15 secret cisco
      !
      interface GigabitEthernet1
       description MGMT-INTERFACE
       ip address 198.18.1.203 255.255.255.0
       no shutdown
      !
      interface Loopback0
       description OSPF-ROUTER-ID
       ip address 10.255.255.3 255.255.255.255
      !
      interface GigabitEthernet2
       description Link-to-Router-1
       ip address 10.1.13.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet3
       description Link-to-Router-2
       ip address 10.1.23.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet4
       description Link-to-Router-4
       ip address 10.1.34.1 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      router ospf 1
       router-id 10.255.255.3
       log-adjacency-changes detail
       network 10.1.13.0 0.0.0.3 area 0
       network 10.1.23.0 0.0.0.3 area 0
       network 10.1.34.0 0.0.0.3 area 0
       network 10.255.255.3 0.0.0.0 area 0
      !
      ip route 0.0.0.0 0.0.0.0 198.18.1.1
      !
      logging host 198.18.134.22
      logging trap informational
      logging source-interface GigabitEthernet1
      logging on
      !
      snmp-server community public RO
      snmp-server community private RW
      snmp-server location CML-Lab-dCloud
      snmp-server contact admin@brkops.local
      snmp-server enable traps ospf state-change
      snmp-server enable traps ospf errors
      snmp-server enable traps ospf lsa
      snmp-server enable traps config
      snmp-server enable traps syslog
      snmp-server host 198.18.134.22 version 2c public
      !
      telemetry ietf subscription 101
       encoding encode-kvgpb
       filter xpath /process-cpu-ios-xe-oper:cpu-usage/cpu-utilization/five-seconds
       source-address 198.18.1.203
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 102
       encoding encode-kvgpb
       filter xpath /interfaces-ios-xe-oper:interfaces/interface/statistics
       source-address 198.18.1.203
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 103
       encoding encode-kvgpb
       filter xpath /memory-ios-xe-oper:memory-statistics/memory-statistic
       source-address 198.18.1.203
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 104
       encoding encode-kvgpb
       filter xpath /ospf-ios-xe-oper:ospf-oper-data
       source-address 198.18.1.203
       stream yang-push
       update-policy on-change
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      netconf-yang
      !
      ip domain name brkops.local
      crypto key generate rsa modulus 2048
      !
      line vty 0 4
       login local
       transport input ssh
      !
      line console 0
       logging synchronous
      !
      end
    ram: 4096
    cpus: 1
    interfaces:
      - id: i0
        label: GigabitEthernet1
        slot: 0
        type: physical
      - id: i1
        label: GigabitEthernet2
        slot: 1
        type: physical
      - id: i2
        label: GigabitEthernet3
        slot: 2
        type: physical
      - id: i3
        label: GigabitEthernet4
        slot: 3
        type: physical

  - id: n3
    label: Router-4
    node_definition: cat8000v
    x: 200
    y: 100
    configuration: |
      hostname Router-4
      !
      enable secret cisco
      username admin privilege 15 secret cisco
      !
      interface GigabitEthernet1
       description MGMT-INTERFACE
       ip address 198.18.1.204 255.255.255.0
       no shutdown
      !
      interface Loopback0
       description OSPF-ROUTER-ID
       ip address 10.255.255.4 255.255.255.255
      !
      interface GigabitEthernet2
       description Link-to-Router-1
       ip address 10.1.14.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet3
       description Link-to-Router-2
       ip address 10.1.24.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      interface GigabitEthernet4
       description Link-to-Router-3
       ip address 10.1.34.2 255.255.255.252
       ip ospf network point-to-point
       no shutdown
      !
      router ospf 1
       router-id 10.255.255.4
       log-adjacency-changes detail
       network 10.1.14.0 0.0.0.3 area 0
       network 10.1.24.0 0.0.0.3 area 0
       network 10.1.34.0 0.0.0.3 area 0
       network 10.255.255.4 0.0.0.0 area 0
      !
      ip route 0.0.0.0 0.0.0.0 198.18.1.1
      !
      logging host 198.18.134.22
      logging trap informational
      logging source-interface GigabitEthernet1
      logging on
      !
      snmp-server community public RO
      snmp-server community private RW
      snmp-server location CML-Lab-dCloud
      snmp-server contact admin@brkops.local
      snmp-server enable traps ospf state-change
      snmp-server enable traps ospf errors
      snmp-server enable traps ospf lsa
      snmp-server enable traps config
      snmp-server enable traps syslog
      snmp-server host 198.18.134.22 version 2c public
      !
      telemetry ietf subscription 101
       encoding encode-kvgpb
       filter xpath /process-cpu-ios-xe-oper:cpu-usage/cpu-utilization/five-seconds
       source-address 198.18.1.204
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 102
       encoding encode-kvgpb
       filter xpath /interfaces-ios-xe-oper:interfaces/interface/statistics
       source-address 198.18.1.204
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 103
       encoding encode-kvgpb
       filter xpath /memory-ios-xe-oper:memory-statistics/memory-statistic
       source-address 198.18.1.204
       stream yang-push
       update-policy periodic 1000
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      telemetry ietf subscription 104
       encoding encode-kvgpb
       filter xpath /ospf-ios-xe-oper:ospf-oper-data
       source-address 198.18.1.204
       stream yang-push
       update-policy on-change
       receiver ip address 198.18.134.22 57400 protocol grpc-tcp
      !
      netconf-yang
      !
      ip domain name brkops.local
      crypto key generate rsa modulus 2048
      !
      line vty 0 4
       login local
       transport input ssh
      !
      line console 0
       logging synchronous
      !
      end
    ram: 4096
    cpus: 1
    interfaces:
      - id: i0
        label: GigabitEthernet1
        slot: 0
        type: physical
      - id: i1
        label: GigabitEthernet2
        slot: 1
        type: physical
      - id: i2
        label: GigabitEthernet3
        slot: 2
        type: physical
      - id: i3
        label: GigabitEthernet4
        slot: 3
        type: physical

  - id: n4
    label: ext-conn-0
    node_definition: external_connector
    x: 0
    y: -300
    configuration: bridge1
    interfaces:
      - id: i0
        label: port
        slot: 0
        type: physical

  - id: n5
    label: mgmt-switch
    node_definition: unmanaged_switch
    x: 0
    y: -200
    interfaces:
      - id: i0
        label: port0
        slot: 0
        type: physical
      - id: i1
        label: port1
        slot: 1
        type: physical
      - id: i2
        label: port2
        slot: 2
        type: physical
      - id: i3
        label: port3
        slot: 3
        type: physical
      - id: i4
        label: port4
        slot: 4
        type: physical

links:
  # External connector to management switch
  - id: l0
    n1: n4
    i1: i0
    n2: n5
    i2: i0
  # Management connections (routers to management switch)
  - id: l1
    n1: n5
    i1: i1
    n2: n0
    i2: i0
  - id: l2
    n1: n5
    i1: i2
    n2: n1
    i2: i0
  - id: l3
    n1: n5
    i1: i3
    n2: n2
    i2: i0
  - id: l4
    n1: n5
    i1: i4
    n2: n3
    i2: i0

  # Full mesh inter-router links (6 links)
  # R1 <-> R2 (10.1.12.0/30)
  - id: l5
    n1: n0
    i1: i1
    n2: n1
    i2: i1

  # R1 <-> R3 (10.1.13.0/30)
  - id: l6
    n1: n0
    i1: i2
    n2: n2
    i2: i1

  # R1 <-> R4 (10.1.14.0/30)
  - id: l7
    n1: n0
    i1: i3
    n2: n3
    i2: i1

  # R2 <-> R3 (10.1.23.0/30)
  - id: l8
    n1: n1
    i1: i2
    n2: n2
    i2: i2

  # R2 <-> R4 (10.1.24.0/30)
  - id: l9
    n1: n1
    i1: i3
    n2: n3
    i2: i2

  # R3 <-> R4 (10.1.34.0/30)
  - id: l10
    n1: n2
    i1: i3
    n2: n3
    i2: i3
